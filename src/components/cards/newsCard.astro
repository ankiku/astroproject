---
import Divider from "../bases/divider.astro";

type Article = {
  title: string;
  slug: string;
  description?: string;
  cover?: string;
};

type Props = {
  article: Article;
  index: number;
};

const { article, index } = Astro.props;

/**
 * Performance rules:
 * - First card = true LCP → eager + high priority
 * - Second card = eager (mobile assist)
 * - Others = lazy
 */
const isLCP = index === 0;
const eagerLoad = index === 0 || index === 1;
---

<article
  class="col-span-1 max-w-sm mx-auto flex flex-col gap-2 h-full"
  itemscope
  itemtype="https://schema.org/Article"
>
  <a
    href={`/${article.slug}`}
    aria-label={`Read article: ${article.title}`}
    itemprop="url"
  >
    <div class="aspect-video overflow-hidden rounded-md bg-gray-100">
      {
        article.cover && (
          <img
            src={article.cover}
            srcset={`
              ${article.cover}?w=400 400w,
              ${article.cover}?w=700 700w,
              ${article.cover}?w=900 900w
            `}
            sizes="(max-width: 640px) 90vw, 674px"
            alt={article.title}
            itemprop="image"
            width="674"
            height="378"
            decoding="async"
            loading={eagerLoad ? "eager" : "lazy"}
            fetchpriority={isLCP ? "high" : "auto"}
            class="w-full h-full object-cover transition-transform duration-300 hover:scale-105"
          />
        )
      }
    </div>
  </a>

  <h3 class="text-lg font-semibold leading-snug" itemprop="headline">
    <a href={`/${article.slug}`} class="hover:underline">
      {article.title}
    </a>
  </h3>

  {
    article.description && (
      <p class="text-sm text-gray-600" itemprop="description">
        {article.description}
      </p>
    )
  }

  <Divider />

  <a
    href={`/${article.slug}`}
    class="text-sm font-medium text-primary hover:underline mt-auto"
  >
    Read more →
  </a>
</article>
