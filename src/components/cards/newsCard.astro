---
import Divider from "../bases/divider.astro";
import { Image } from "astro:assets";

type Article = {
  title: string;
  slug: string;
  description?: string;
  cover?: string;
};

type Props = {
  article: Article;
  index: number;
};

const { article, index } = Astro.props;

/**
 * Performance rules:
 * - Mobile: eager load first 2
 * - Desktop: eager load only first
 */
const eagerLoad = index === 0 || index === 1;
---

<article
  class="col-span-1 max-w-sm mx-auto flex flex-col gap-2 h-full"
  itemscope
  itemtype="https://schema.org/Article"
>
  <a
    href={`/${article.slug}`}
    aria-label={`Read article: ${article.title}`}
    itemprop="url"
  >
    <div class="aspect-video overflow-hidden rounded-md bg-gray-100">
      {
        article.cover && (
          <Image
            src={article.cover}
            alt={article.title}
            itemprop="image"
            widths={[320, 480, 640, 768]}
            sizes="(max-width: 768px) 90vw, 640px"
            format="webp"
            quality={70}
            inferSize={true}
            loading={eagerLoad ? "eager" : "lazy"}
            fetchpriority={eagerLoad ? "high" : "auto"}
            class="w-full h-full object-cover transition-transform duration-300 hover:scale-105"
          />
        )
      }
    </div>
  </a>

  <h3 class="text-lg font-semibold leading-snug" itemprop="headline">
    <a href={`/${article.slug}`} class="hover:underline">
      {article.title}
    </a>
  </h3>

  {
    article.description && (
      <p class="text-sm text-gray-600" itemprop="description">
        {article.description}
      </p>
    )
  }

  <Divider />

  <a
    href={`/${article.slug}`}
    class="text-sm font-medium text-primary hover:underline mt-auto"
  >
    Read more â†’
  </a>
</article>
