---
import Divider from "../bases/divider.astro";
import { cfImage } from "@/lib/cfImage";

type Article = {
  title: string;
  slug: string;
  description?: string;
  cover?: string;
};

type Props = {
  article: Article;
  index: number;
};

const { article, index } = Astro.props;

/* ✅ LCP RULE: ONLY FIRST IMAGE */
const eagerLoad = index === 0;
---

<article
  class="col-span-1 max-w-sm mx-auto flex flex-col gap-2 h-full"
  itemscope
  itemtype="https://schema.org/Article"
>
  <a
    href={`/${article.slug}`}
    aria-label={`Read article: ${article.title}`}
    itemprop="url"
  >
    <div class="aspect-video overflow-hidden rounded-md bg-gray-100">
      {
        article.cover && (
          <img
            src={cfImage(article.cover, { w: 640, h: 360 })}
            alt={article.title}
            width="640"
            height="360"
            loading={eagerLoad ? "eager" : "lazy"}
            fetchpriority={eagerLoad ? "high" : "auto"}
            decoding="async"
            sizes="(max-width: 768px) 100vw, 33vw"
            class="w-full h-full object-cover transition-transform duration-300 hover:scale-105"
          />
        )
      }
    </div>
  </a>

  <h3 class="text-lg font-semibold leading-snug" itemprop="headline">
    <a href={`/${article.slug}`} class="hover:underline">
      {article.title}
    </a>
  </h3>

  {
    article.description && (
      <p class="text-sm text-gray-600" itemprop="description">
        {article.description}
      </p>
    )
  }

  <Divider />

  <a
    href={`/${article.slug}`}
    class="text-sm font-medium text-primary hover:underline mt-auto"
  >
    Read more →
  </a>
</article>
